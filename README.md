# ポモドーロタイマー アプリ

このリポジトリには、Node.jsで作成されたポモドーロタイマーアプリケーションのコードが含まれています。このアプリは、優しくてかわいいずんだもちの妖精「ずんだもん」による音声ナレーションで、作業と休憩を促します。音声は[VOICEVOX APIを使用して生成されます。

## 機能概要

- **ポモドーロタイマー**: 作業時間と休憩時間を設定し、タイマーに従って作業と休憩の通知を音声で行います。
- **VOICEVOX音声合成**: [VOICEVOX](https://voicevox.hiroshiba.jp/)を使用して、音声ナレーションを生成します。
- **OpenAI API**: ずんだもんのキャラクターに合わせたユニークなメッセージを生成するためにOpenAIのAPIを使用します。
- **通知機能**: OSのネイティブ通知機能を使用して、ユーザーに視覚的な通知も提供します。
- **使用時間の指定**: コマンドライン引数で使用時間を指定することができます。

## 使用技術

- **Node.js**: アプリケーションのバックエンドロジック。
- **VOICEVOX API**: 音声合成を行うための外部API。
- **OpenAI API**: キャラクター性を持たせたナレーションメッセージを生成。
- **node-notifier**: OSの通知を表示。
- **axios**: HTTPリクエストを送信するためのライブラリ。

# ポモドーロタイマーアプリのセットアップと実行手順

## 必要なコマンドの実行
まず、[VOICEVOXエンジン](https://github.com/VOICEVOX/voicevox_engine/)を起動する必要があります。以下のコマンドを実行してください。  

```sh
sudo docker pull voicevox/voicevox_engine:cpu-ubuntu20.04-latest
sudo docker run --rm -p '127.0.0.1:50021:50021' voicevox/voicevox_engine:cpu-ubuntu20.04-latest
```

## セットアップ手順

1. **Node.js と npm のインストール**
   
   Node.js と npm をインストールするために、以下のコマンドを実行します。

   ```sh
   sudo apt update
   sudo apt install -y nodejs npm
   ```

2. **必要なパッケージのインストール**

   プロジェクトフォルダに移動して、必要なnpmパッケージをインストールします。

   ```sh
   npm install
   ```

3. **OpenAI API キーの設定**

   OpenAI API キーを環境変数として設定します。`.env` ファイルを作成し、次のように記述します。

   ```env
   OPENAI_API_KEY=your_openai_api_key_here
   ```

4. **実行するための準備**

   以下のコマンドで、プログラムを実行する準備が整います。

   ```sh
   node --env-file=.env main.js name=ユーザ名
   ```
   
   `name` 引数には任意の名前を指定できます。これによって、ずんだもんがその名前を呼びかけるようになります。

## 動作確認

- **通常モードで実行する場合**
  
  ```sh
  node --env-file=.env main.js name=太郎
  ```
  
  - 作業時間は25分、休憩時間は5分になります。

- **テストモードで実行する場合**
  
  テストモードを使用するには、`test` 引数を追加してください。
  
  ```sh
  node --env-file=.env main.js name=太郎 test
  ```
  
  - 作業時間は1分、休憩時間は30秒になります。

- **使用時間の指定**
  
  使用時間を指定するには、`usageTime` 引数を追加してください。使用時間は分単位で指定できます。
  
  ```sh
  node --env-file=.env main.js name=太郎 usageTime=60
  ```
  
  - この場合、タイマーは60分間動作します。

## 重要事項

- **VOICEVOX エンジンの起動**: このアプリは VOICEVOX エンジンを使用して音声を生成します。必ず事前に Docker コマンドで VOICEVOX エンジンを起動しておいてください。
- **通知機能**: 通知は macOS、Windows、Linux でサポートされています。各OSの通知機能を使用して、作業や休憩の開始・終了を知らせます。

## トラブルシューティング

1. **VOICEVOX エンジンが起動していない場合**
   - VOICEVOX エンジンが正しく起動しているか確認してください。Docker コンテナが実行中で、ポート `50021` がリッスンされている必要があります。

2. **API キーに関するエラー**
   - OpenAI API キーが正しく設定されていることを確認してください。`.env` ファイルが読み込まれていない場合、エラーが発生する可能性があります。

3. **通知が表示されない場合**
   - 通知機能が正しく動作しない場合は、通知の設定がOS側で無効化されていないか確認してください。

## 構成ファイルの説明

- **`index.js`**: アプリケーションのメインスクリプト。
- **`package.json`**: 依存ライブラリとスクリプト情報。

## 各機能の詳細説明

### 1. タイマー管理
- 作業と休憩を交互に行うポモドーロタイマーの仕組みです。
- **`workDuration`** と **`breakDuration`** により、時間の長さを設定しています。
- テストモードで時間を短縮して実行することも可能です。

### 2. 音声ナレーション生成
- OpenAIのAPIを用いて、ずんだもんのキャラクター性を持たせたユニークなナレーションを生成します。
- 日本語でユーザーに対して休憩や作業の促しを行います。
- VOICEVOX APIを使って、そのナレーションを音声に変換し、ユーザーに聞かせます。

### 3. 音声合成と通知機能
- **`synthesizeAndPlayVoice`** 関数で音声合成と再生を行います。
- **`node-notifier`** ライブラリを使用して、ユーザーに視覚的な通知を行います。

### 4. ユーザーデータの設定
- ユーザーの名前をコマンドライン引数で設定することで、パーソナライズされたメッセージを生成します。

## 実行中の制御

- タイマーが動作している間、作業と休憩の切り替えを繰り返します。
- プロセスを終了する場合は `Ctrl + C` で終了できます。
- 終了時には、ずんだもんが「ポモドーロタイマーアプリ、終了します」とナレーションでお知らせします。

## 注意点

- **VOICEVOXのエンドポイント**が正しく設定されていることを確認してください。エンドポイントが間違っている場合、音声合成に失敗します。

## 開発者向け情報

### デバッグ
- **テストモード**で短い時間間隔での動作確認が可能です。
- 音声合成やOpenAI APIの呼び出しでエラーが発生した場合、コンソールに詳細なエラーメッセージが出力されます。

### 環境変数
- OpenAI APIキーを `.env` ファイルまたは環境変数に設定して、セキュリティを確保します。

### ボイスの変更
- Docker起動コマンド後、http://127.0.0.1:50021/speakers にアクセスすることで、ボイスの一覧を確認することができます。

## クレジット

- VOICEVOX:ずんだもん: 本アプリの音声ナレーションには、[VOICEVOX](https://voicevox.hiroshiba.jp/)のずんだもんを使用しています。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 問い合わせ

質問や問題があれば、[GitHub Issues](https://github.com/あなたのリポジトリ/issues)に投稿してください。

